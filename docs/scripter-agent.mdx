---
title: "ScripterAgent"
description: "Thực thi Python Off-device để gọi API, thao tác tệp tin và xử lý dữ liệu."
---

# ScripterAgent

**ScripterAgent** là một thành phần chuyên trách việc thực thi mã **Python bên ngoài thiết bị** (off-device). Nó được sử dụng cho các tác vụ không cần tương tác trực tiếp với giao diện thiết bị di động, giúp tối ưu hóa hiệu năng và mở rộng khả năng của hệ thống.

## ScripterAgent là gì?

ScripterAgent thực thi mã Python cho các nhiệm vụ như gọi API, thao tác tệp hoặc xử lý dữ liệu phức tạp. Trong ứng dụng **Tauri v2**, nó đóng vai trò là "engine" xử lý logic mạnh mẽ bên cạnh việc tương tác với thiết bị di động. Nó được kích hoạt bởi **ManagerAgent** khi cần các xử lý logic thuần túy mà không liên quan đến việc chạm/vuốt trên màn hình điện thoại.

### Khả năng chính:
- **Gọi API**: Thực hiện các yêu cầu REST API, Webhooks, truy vấn cơ sở dữ liệu.
- **Thao tác tệp**: Đọc, ghi và phân tích các tệp tin (CSV, JSON, v.v.).
- **Xử lý dữ liệu**: Phân tích cú pháp JSON/CSV, chuyển đổi và lọc dữ liệu.
- **Tích hợp Workflow**: Cho phép nhúng mã xử lý tùy chỉnh vào giữa các bước tự động hóa thiết bị.

> **Sự khác biệt chính**: ScripterAgent chạy mã **không tương tác với thiết bị**, trong khi `CodeActAgent` tạo ra mã sử dụng các hành động nguyên tử (atomic actions) trên thiết bị.

## Cơ chế hoạt động

ManagerAgent ủy thác nhiệm vụ cho ScripterAgent bằng cách cung cấp ngữ cảnh đầy đủ và mô tả nhiệm vụ ở mức cao. ScripterAgent hoạt động theo vòng lặp **ReAct** (Think-Execute-Observe):

1.  **Nhận nhiệm vụ**: Từ ManagerAgent với đầy đủ ngữ cảnh.
2.  **Suy nghĩ (Think)**: Phân tích và tạo mã Python để thực hiện nhiệm vụ.
3.  **Thực thi (Execute)**: Chạy mã và quan sát kết quả đầu ra.
4.  **Lặp lại**: Tiếp tục vòng lặp cho đến khi nhiệm vụ hoàn thành.
5.  **Báo cáo**: Trả về thông báo tóm tắt kết quả cho ManagerAgent.

*Lưu ý: Các biến số được lưu giữ qua các bước thực thi (giống như Jupyter notebook).*

## Ví dụ sử dụng

### Gọi API
Khi cần lấy dữ liệu thời tiết để phục vụ một workflow:

```python
# Think: Tôi cần gọi API để lấy thông tin thời tiết
import requests

response = requests.get(
    "https://api.weather.com/forecast",
    params={"city": "San Francisco"}
)
print(response.json())
```

### Thao tác tệp tin
Lọc danh sách liên hệ từ tệp CSV và lưu lại dưới dạng JSON:

```python
import csv
import json

with open('/tmp/contacts.csv', 'r') as f:
    reader = csv.DictReader(f)
    contacts = list(reader)

# Lọc liên hệ tại New York
ny_contacts = [c for c in contacts if c['city'] == 'New York']

with open('/tmp/filtered_contacts.json', 'w') as f:
    json.dump(ny_contacts, f, indent=2)
```

## Cấu hình & Bảo mật

ScripterAgent được bảo vệ bởi cơ chế **Safe Execution**, hạn chế các thư viện nguy hiểm theo mặc định.

```yaml
agent:
  scripter:
    max_steps: 10
    safe_execution:
      enabled: true
      allowed_modules:
        - requests
        - json
        - csv
        - pathlib
      blocked_modules:
        - subprocess
        - os
        - sys
```

## Ứng dụng trong DroidRun Tauri v2

Trong dự án Tauri v2 hiện tại, ScripterAgent (thông qua `PythonStep`) cho phép bạn:

1.  **Xử lý biến động**: Sử dụng `inputs` và `variables` từ Workflow để tính toán logic phức tạp (ví dụ: lấy giá trị từ một bước trước đó, tính toán lại rồi dùng cho bước sau).
2.  **Mở rộng bộ công cụ**: Dùng các thư viện Python mạnh mẽ như `requests` để tương tác với server nội bộ hoặc `pandas` để xử lý tập dữ liệu lớn mà Rust/JS khó xử lý nhanh.
3.  **Lưu kết quả**: Sử dụng tham số `save_to` trong cấu hình Step để lưu kết quả từ script Python vào bộ nhớ tạm của Workflow, giúp các bước sau (như `PromptStep` hoặc `ActionStep`) có thể truy cập qua cú pháp `{{variable}}`.

## Đề xuất Tích hợp vào Dự án

Dựa trên cấu trúc code hiện tại, ScripterAgent nên được triển khai tại các vị trí sau:

### 1. Nâng cấp Workflow Engine (`workflow.rs`)
- **Action**: Chuyển đổi `PythonStep` hiện tại thành một **AI Scripting Step**.
- **Cách làm**: Cho phép Step nhận một "Prompt" thay vì code cứng. Dùng LLM để sinh mã Python thực thi (gọi API, tính toán) dựa trên trạng thái Workflow hiện tại.

### 2. Xử lý hậu kỳ Task (`task.rs`)
- **Action**: Sử dụng ScripterAgent làm trợ lý phân tích lỗi.
- **Cách làm**: Khi một `run_task` thất bại, ScripterAgent có thể tự động quét log và dữ liệu trả về để đề xuất hướng khắc phục hoặc tự động điều chỉnh tham số cho lần chạy sau.

### 3. Module Công cụ Tùy chỉnh (`lib.rs`)
- **Action**: Đăng ký các "Skill" xử lý dữ liệu phức tạp.
- **Cách làm**: Viết các script Python ScripterAgent cho các tác vụ như: Giải mã OTP từ webhook, Gửi báo cáo định kỳ lên Google Sheets/Telegram.

## Các điểm then chốt
- **ReAct Agent**: Vòng lặp Suy nghĩ-Thực thi-Quan sát.
- **Off-device only**: Không tương tác với thiết bị di động.
- **Lưu giữ trạng thái**: Các biến tồn tại xuyên suốt các vòng lặp.
- **An toàn mặc định**: Giới hạn các thư viện hệ thống nguy hiểm.
- **Tích hợp sâu**: Dễ dàng trao đổi dữ liệu với hệ thống Workflow của Tauri v2 thông qua context JSON.